# ü§ñ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ AI-—á–∞—Ç–∞ —Å n8n

## –û–±–∑–æ—Ä

–ß–∞—Ç-–≤–∏–¥–∂–µ—Ç —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ —Å–∞–π—Ç –∏ –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–∞—à–∏–º AI-–∞–≥–µ–Ω—Ç–æ–º —á–µ—Ä–µ–∑ n8n.

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:** `/components/ChatWidget.tsx`  
**–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤:** `/App.tsx` (–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö)

---

## üìç –¢–æ—á–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

–í —Ñ–∞–π–ª–µ `/components/ChatWidget.tsx` –Ω–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º:

```typescript
// ============================================================
// üîå –¢–û–ß–ö–ê –ò–ù–¢–ï–ì–†–ê–¶–ò–ò –° N8N API
// ============================================================
```

–≠—Ç–∞ —Å–µ–∫—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `handleSendMessage()` (—Å—Ç—Ä–æ–∫–∏ ~60-120).

---

## üîß –®–∞–≥–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 1. –°–æ–∑–¥–∞–π—Ç–µ webhook –≤ n8n

1. –í n8n —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π workflow
2. –î–æ–±–∞–≤—å—Ç–µ —É–∑–µ–ª **Webhook** –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–µ—Ç–æ–¥: `POST`
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL webhook (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://your-n8n-instance.com/webhook/chat`)

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ n8n workflow

–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ workflow:

```
Webhook (POST) 
  ‚Üì
[–í–∞—à AI-–∞–≥–µ–Ω—Ç / ChatGPT / –¥—Ä—É–≥–æ–π LLM]
  ‚Üì
Function (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞)
  ‚Üì
Respond to Webhook
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç —á–∞—Ç–∞:**

```json
{
  "message": "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
  "sessionId": "session_1234567890_abc123",
  "timestamp": "2025-11-28T10:30:00.000Z"
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç n8n:**

```json
{
  "response": "–û—Ç–≤–µ—Ç AI-–∞–≥–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
  "status": "success"
}
```

–∏–ª–∏

```json
{
  "message": "–û—Ç–≤–µ—Ç AI-–∞–≥–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
}
```

### 3. –ó–∞–º–µ–Ω–∏—Ç–µ –∫–æ–¥ –≤ ChatWidget.tsx

–ù–∞–π–¥–∏—Ç–µ –±–ª–æ–∫ –∫–æ–¥–∞ –ø–æ—Å–ª–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è `// üîå –¢–û–ß–ö–ê –ò–ù–¢–ï–ì–†–ê–¶–ò–ò –° N8N API` –∏ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ/–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç —à–∞–±–ª–æ–Ω:

```typescript
try {
  const response = await fetch('https://your-n8n-instance.com/webhook/chat', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      // –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:
      // 'Authorization': 'Bearer YOUR_SECRET_TOKEN',
    },
    body: JSON.stringify({
      message: userMessage.text,
      sessionId: getSessionId(), // –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–µ—Å–µ–¥—ã
      timestamp: userMessage.timestamp,
    }),
  });

  if (!response.ok) {
    throw new Error(`HTTP error! status: ${response.status}`);
  }

  const data = await response.json();
  
  const botMessage: Message = {
    id: Date.now().toString() + '-bot',
    text: data.response || data.message, // –ê–¥–∞–ø—Ç–∏—Ä—É–π –ø–æ–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–≤–æ–µ–≥–æ –æ—Ç–≤–µ—Ç–∞
    sender: "bot",
    timestamp: new Date(),
  };

  setMessages((prev) => [...prev, botMessage]);
} catch (error) {
  console.error('Chat API error:', error);
  
  const errorMessage: Message = {
    id: Date.now().toString() + '-error',
    text: "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É +7 (914) 399 7401.",
    sender: "bot",
    timestamp: new Date(),
  };
  
  setMessages((prev) => [...prev, errorMessage]);
} finally {
  setIsLoading(false);
}
```

### 4. –£–¥–∞–ª–∏—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—É—é –∑–∞–≥–ª—É—à–∫—É

–ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è API —É–¥–∞–ª–∏—Ç–µ —ç—Ç—É —á–∞—Å—Ç—å –∫–æ–¥–∞:

```typescript
// –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ (—É–¥–∞–ª–∏ –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è API)
setTimeout(() => {
  const botMessage: Message = {
    id: Date.now().toString() + "-bot",
    text: "–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!...",
    sender: "bot",
    timestamp: new Date(),
  };
  setMessages((prev) => [...prev, botMessage]);
  setIsLoading(false);
}, 1000);
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **CORS**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ CORS –≤ n8n –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞
   ```
   Access-Control-Allow-Origin: https://yourdomain.com
   ```

2. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization
   - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç–æ–∫–µ–Ω –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ n8n

3. **Rate Limiting**:
   - –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sessionId –¥–ª—è —Ç—Ä–µ–∫–∏–Ω–≥–∞

4. **–í–∞–ª–∏–¥–∞—Ü–∏—è**:
   - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥–ª–∏–Ω—É —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, max 500 —Å–∏–º–≤–æ–ª–æ–≤)
   - –§–∏–ª—å—Ç—Ä—É–π—Ç–µ –æ–ø–∞—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç

---

## üé® –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞

–î–æ–±–∞–≤—å—Ç–µ –≤ n8n —É–∑–µ–ª –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏:

```
Webhook 
  ‚Üì
Database (Save Message)
  ‚Üì
AI Agent
  ‚Üì
Database (Save Response)
  ‚Üì
Respond to Webhook
```

### 2. –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —á–∞—Ç–∞

–í `ChatWidget.tsx` –¥–æ–±–∞–≤—å—Ç–µ useEffect:

```typescript
useEffect(() => {
  if (isOpen) {
    loadChatHistory();
  }
}, [isOpen]);

const loadChatHistory = async () => {
  try {
    const response = await fetch(`https://your-n8n.com/webhook/history/${getSessionId()}`);
    const data = await response.json();
    
    if (data.messages) {
      setMessages([
        messages[0], // –°–æ—Ö—Ä–∞–Ω—è–µ–º welcome message
        ...data.messages
      ]);
    }
  } catch (error) {
    console.error('Failed to load chat history:', error);
  }
};
```

### 3. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ê–≥–µ–Ω—Ç –ø–µ—á–∞—Ç–∞–µ—Ç"

–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `isLoading` –∏ –∞–Ω–∏–º–∞—Ü–∏—é —Å —Ç–æ—á–∫–∞–º–∏.

### 4. –ë–µ–π–¥–∂ —Å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞ floating –∫–Ω–æ–ø–∫—É:

```tsx
<button className="relative ...">
  <MessageCircle className="w-7 h-7" />
  {unreadCount > 0 && (
    <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
      {unreadCount}
    </span>
  )}
</button>
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å mock –¥–∞–Ω–Ω—ã–º–∏

–í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–≥–ª—É—à–∫–∞ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞. –ü—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º n8n

1. –ó–∞–º–µ–Ω–∏—Ç–µ URL –≤ –∫–æ–¥–µ –Ω–∞ –≤–∞—à webhook
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ n8n –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è workflow
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–≤–µ—Ç –≤ —á–∞—Ç–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–º n8n - –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ.

---

## üìä –ü—Ä–∏–º–µ—Ä—ã n8n workflows

### –ü—Ä–æ—Å—Ç–æ–π ChatGPT –±–æ—Ç

```
1. Webhook (POST)
   ‚Üì
2. OpenAI (Chat completion)
   - Model: gpt-4
   - System prompt: "–¢—ã AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∫–∞–¥—Ä–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ –ê–ª—Ç–∞–Ω–∞..."
   - User message: {{ $json.message }}
   ‚Üì
3. Code (Format response)
   ```javascript
   return {
     response: items[0].json.choices[0].message.content
   };
   ```
   ‚Üì
4. Respond to Webhook
```

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π workflow —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

```
1. Webhook (POST)
   ‚Üì
2. Redis/Database GET (–∑–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ sessionId)
   ‚Üì
3. Code (–ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç)
   ‚Üì
4. OpenAI (—Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º)
   ‚Üì
5. Redis/Database SET (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—ã–π –æ—Ç–≤–µ—Ç)
   ‚Üì
6. Respond to Webhook
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –°–æ–∑–¥–∞–π webhook –≤ n8n
2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π AI-–∞–≥–µ–Ω—Ç–∞ (ChatGPT, Claude, etc.)
3. ‚úÖ –ó–∞–º–µ–Ω–∏ –∫–æ–¥ –≤ `ChatWidget.tsx`
4. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –ª–æ–∫–∞–ª—å–Ω–æ
5. ‚úÖ –ó–∞–¥–µ–ø–ª–æ–π –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –≤ production

---

## üí° –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–º–æ—â–∏

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è n8n: https://docs.n8n.io/
- Community forum: https://community.n8n.io/

**–ì–æ—Ç–æ–≤–æ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏!** üöÄ
